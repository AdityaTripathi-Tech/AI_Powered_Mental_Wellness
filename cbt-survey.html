<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Mental Health Survey</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #a8e6ff, #a1c4fd); /* Gradient background */
            color: #333;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: auto;
            background: #ffffff;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            padding: 30px;
            overflow: hidden;
        }

        h1, h2 {
            color: #228B22;
            text-align: center;
            margin-bottom: 20px;
        }

        .progress {
            height: 25px;
            margin-bottom: 20px;
            border-radius: 50px;
        }

        .question {
            margin-bottom: 30px;
            padding: 10px;
            border-radius: 8px;
            background: #f9f9f9;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }

        .question p {
            font-size: 18px;
            margin-bottom: 15px;
        }

        .question input[type="radio"] {
            margin-right: 10px;
        }

        .submit-btn, .next-btn, .analyze-btn {
            background-color: #32CD32;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        .submit-btn:hover, .next-btn:hover, .analyze-btn:hover {
            background-color: #228B22;
        }

        #resultContainer, #analysisContainer {
            display: none;
        }

        canvas {
            max-width: 100%;
            height: auto;
            margin-top: 20px;
        }

        .buttons a, .buttons button {
            padding: 12px 20px;
            background-color: #32CD32;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            margin-right: 15px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }

        .buttons a:hover, .buttons button:hover {
            background-color: #228B22;
        }

        #aiAnalysis {
            background: #e8f5e8;
            border: 1px solid #cceccc;
            padding: 20px;
            margin-top: 30px;
            border-radius: 10px;
            display: none;
        }

        #aiAnalysis h2 {
            color: #228b22;
            margin-bottom: 15px;
        }

        #aiAnalysis p {
            font-size: 16px;
            line-height: 1.6;
            color: #333;
        }

        /* Custom animations for results */
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(-20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 1s ease-out;
        }

    </style>
</head>
<body>
    <div class="container" id="startContainer">
        <h1>Comprehensive Mental Health Survey</h1>
        <p>Select the number of questions for the survey:</p>
        <button class="next-btn" onclick="startSurvey(20)">20 Questions</button>
        <button class="next-btn" onclick="startSurvey(40)">40 Questions</button>
        <button class="next-btn" id="backButton">Go Back to Home</button> <br>
    </div>

    <div class="container" id="surveyContainer" style="display:none;">
        <h1>Mental Health Survey</h1>
        <div class="progress">
            <div class="progress-bar bg-success" role="progressbar" style="width: 0%;" id="progressBar">0%</div>
        </div>
        <form id="surveyForm">
            <!-- Questions dynamically injected here -->
        </form>
        <button type="button" class="next-btn" id="nextBtn">Next</button>
    </div>

    <div class="container" id="resultContainer">
        <h2>Survey Results</h2>
        <canvas id="resultChart"></canvas>
        <button class="analyze-btn" onclick="analyzeSymptoms()">Analyze Symptoms</button>
    </div>

    <div class="container" id="analysisContainer">
        <h2>AI Analysis</h2>
        <button class="next-btn" id="backButton2">Go Back to Home</button> <br>
        <p id="aiAnalysis">Analyzing...</p>
    </div>

    <script>
        const allQuestions = [
            "How often do you feel overwhelmed by stress?",
            "How do you handle criticism from others?",
            "How often do you feel confident in social situations?",
            "How do you typically cope with failure?",
            "Do you find it difficult to control your impulses?",
            "How often do you doubt your self-worth?",
            "How well do you manage your emotions under pressure?",
            "How do you feel about meeting new people?",
            "When faced with a challenge, do you stay optimistic?",
            "Do you find it easy to relax and unwind?",
            "How often do you feel irritated or angry without a clear reason?",
            "Do you find yourself procrastinating on important tasks?",
            "How well do you communicate your thoughts and feelings?",
            "Do you tend to avoid situations that make you anxious?",
            "How do you handle conflicts with others?",
            "How often do you feel restless or uneasy?",
            "Do you enjoy trying new things or experiences?",
            "How often do you replay past mistakes in your mind?",
            "Do you feel comfortable expressing your emotions?",
            "How well do you adapt to unexpected changes?",
            "Do you feel capable of achieving your personal goals?",
            "How often do you have trouble focusing?",
            "Do you feel excessively energetic or restless?",
            "How often do you experience mood swings?",
            "How often do you feel socially isolated?",
            "Do you find it difficult to make decisions?",
            "How often do you feel like your thoughts are racing?",
            "Do you experience feelings of emptiness?",
            "How often do you engage in risky behaviors?",
            "How often do you experience panic attacks?",
            "Do you have trouble remembering details?",
            "How often do you lose track of time?",
            "Do you feel disconnected from your surroundings?",
            "How often do you avoid responsibility?",
            "Do you have difficulty maintaining close relationships?",
            "How often do you feel overwhelmed by minor issues?",
            "Do you find it difficult to stick to a routine?",
            "How often do you feel emotionally numb?",
            "Do you have difficulty sleeping?",
            "How often do you feel uncontrollably sad?"
        ];

        const options = [
            "Very Often",
            "Often",
            "Sometimes",
            "Rarely",
            "Never"
        ];

        const categories = [
            "Stress Management",
            "Self-Esteem",
            "Emotional Resilience",
            "Social Confidence",
            "Impulsivity",
            "Coping Skills"
        ];

        let responses = {
            "Stress Management": 0,
            "Self-Esteem": 0,
            "Emotional Resilience": 0,
            "Social Confidence": 0,
            "Impulsivity": 0,
            "Coping Skills": 0
        };

        let currentQuestion = 0;
        let selectedQuestions = [];

        // Start the survey with the selected number of questions
        function startSurvey(questionCount) {
            selectedQuestions = allQuestions.slice(0, questionCount); // Dynamically select questions
            document.getElementById("startContainer").style.display = "none";
            document.getElementById("surveyContainer").style.display = "block";
            renderQuestion();
            updateProgress();
        }

        // Render the question and options
        function renderQuestion() {
            const form = document.getElementById("surveyForm");
            const categoryIndex = currentQuestion % categories.length;
            form.innerHTML = `
                <div class="question fade-in">
                    <p>${currentQuestion + 1}. ${selectedQuestions[currentQuestion]}</p>
                    ${options
                        .map(
                            (opt, index) =>
                                `<div>
                                    <input type="radio" name="q${currentQuestion}" value="${index}"> ${opt}
                                </div>`
                        )
                        .join("")}
                </div>
            `;
        }

        // Update progress bar based on current question
        function updateProgress() {
            const progress = ((currentQuestion + 1) / selectedQuestions.length) * 100;
            const progressBar = document.getElementById("progressBar");
            progressBar.style.width = `${progress}%`;
            progressBar.textContent = `${Math.round(progress)}%`;
        }

        // Move to the next question
        function nextQuestion() {
            const selected = document.querySelector(`input[name="q${currentQuestion}"]:checked`);
            if (!selected) {
                alert("Please select an option.");
                return;
            }
            const categoryIndex = currentQuestion % categories.length;
            responses[categories[categoryIndex]] += parseInt(selected.value) + 1;
            currentQuestion++;

            if (currentQuestion < selectedQuestions.length) {
                renderQuestion();
                updateProgress();
            } else {
                document.getElementById("surveyContainer").style.display = "none";
                displayResults();
            }
        }

        // Display results as a chart
        function displayResults() {
            document.getElementById("resultContainer").style.display = "block";

            const ctx = document.getElementById("resultChart").getContext("2d");
            new Chart(ctx, {
                type: "bar",
                data: {
                    labels: Object.keys(responses),
                    datasets: [
                        {
                            label: "Score",
                            data: Object.values(responses),
                            backgroundColor: "rgba(50, 205, 50, 0.6)",
                            borderColor: "rgba(50, 205, 50, 1)",
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // Analyze symptoms based on the responses
        function analyzeSymptoms() {
            document.getElementById("analysisContainer").style.display = "block";
            document.getElementById("aiAnalysis").textContent = "Analyzing...";

            // Calculate the scores for different conditions based on survey responses
            const bpdScore = calculateBpdScore(responses);
            const adhdScore = calculateAdhdScore(responses);
            const depressionScore = calculateDepressionScore(responses);

            // Display results dynamically based on the scores
            const analysis = {
                "BPD": `${bpdScore}%`,
                "ADHD": `${adhdScore}%`,
                "Depression": `${depressionScore}%`
            };

            for (const [condition, percentage] of Object.entries(analysis)) {
                const paragraph = document.createElement("p");
                paragraph.textContent = `${condition}: ${percentage}`;
                document.getElementById("analysisContainer").appendChild(paragraph);
            }
        }

        // Weighted scoring logic for BPD
        function calculateBpdScore(responses) {
            let score = 0;
            score += responses["Emotional Resilience"] * 0.3;
            score += responses["Stress Management"] * 0.2;
            score += responses["Impulsivity"] * 0.5;
            return Math.min(Math.round(score), 100); // Make sure the score doesn't exceed 100
        }

        // Weighted scoring logic for ADHD
        function calculateAdhdScore(responses) {
            let score = 0;
            score += responses["Coping Skills"] * 0.3;
            score += responses["Self-Esteem"] * 0.4;
            score += responses["Emotional Resilience"] * 0.3;
            return Math.min(Math.round(score), 100); // Ensure it stays within 100%
        }

        // Weighted scoring logic for Depression
        function calculateDepressionScore(responses) {
            let score = 0;
            score += responses["Self-Esteem"] * 0.5;
            score += responses["Stress Management"] * 0.3;
            score += responses["Social Confidence"] * 0.2;
            return Math.min(Math.round(score), 100); // Ensure the score is valid
        }

        document.getElementById("nextBtn").addEventListener("click", nextQuestion);

        // Go Back to Home functionality
        document.getElementById("backButton").addEventListener("click", function() {
            window.location.href = './index.html';  // Redirect to the home page
        });

        // Back Button 2 for results/analysis page
        document.getElementById("backButton2").addEventListener("click", function() {
            window.location.href = './index.html';  // Redirect to the home page
        });
    </script>
</body>
</html>
